openapi: 3.1.0
info:
  title: Muzika Music Platform API
  description: |
    Combined REST API specification for all Muzika microservices:
    - **AuthorizationManager** - User authentication & JWT tokens
    - **PlaylistManager** - Playlist CRUD operations
    - **QueueManager** - Music queue & playback management
    - **BandcampApi** - Bandcamp music search integration
    - **SlskdDownload** - Song download service
  version: 1.0.0
servers:
  - url: http://localhost:8091
    description: AuthorizationManager service
  - url: http://localhost:8090
    description: QueueManager service
  - url: http://localhost:8092
    description: PlaylistManager service
  - url: http://localhost:8080
    description: BandcampApi service
  - url: http://127.0.0.1:8080
    description: SlskdDownload service
tags:
  - name: Authorization
    description: User authentication and management endpoints (AuthorizationManager)
  - name: Playlist
    description: Playlist management endpoints (PlaylistManager)
  - name: Queue
    description: Queue management endpoints (QueueManager)
  - name: Health
    description: Health check endpoints (all services)
security:
  - bearerAuth: []
paths:
  # AuthorizationManager endpoints
  /api/auth/user:
    post:
      tags:
        - Authorization
      summary: Create new user
      description: Create a new user account with username, password, and optional email (AuthorizationManager)
      operationId: createUser
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
        required: true
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          description: Bad request (validation error, missing required fields, or invalid email format)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '409':
          description: Conflict (username already exists)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
  /user:
    post:
      tags:
        - Authorization
      summary: Create new user
      description: Create a new user account with username, password, and optional email (AuthorizationManager)
      operationId: createUser_1
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
        required: true
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          description: Bad request (validation error, missing required fields, or invalid email format)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '409':
          description: Conflict (username already exists)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
  /login:
    post:
      tags:
        - Authorization
      summary: User login
      description: Authenticate user with username and password, returns JWT token (AuthorizationManager)
      operationId: login
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
        required: true
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Unauthorized (invalid credentials)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
  /api/auth/login:
    post:
      tags:
        - Authorization
      summary: User login
      description: Authenticate user with username and password, returns JWT token (AuthorizationManager)
      operationId: login_1
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
        required: true
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Unauthorized (invalid credentials)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
  /user/{id}:
    delete:
      tags:
        - Authorization
      summary: Delete user
      description: Delete a user account by UUID (AuthorizationManager)
      operationId: deleteUser
      parameters:
        - name: id
          in: path
          description: User UUID
          required: true
          schema:
            type: string
            format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '204':
          description: User deleted successfully (No Content)
        '404':
          description: User not found
        '500':
          description: Internal server error
  # QueueManager endpoints
  /api/queue/songs/{id}/unliked:
    post:
      tags:
        - Queue
      summary: Mark song as unliked
      description: Mark a song as unliked by the authenticated user (QueueManager)
      operationId: markSongAsUnliked
      parameters:
        - name: id
          in: path
          description: Song UUID
          required: true
          schema:
            type: string
            format: uuid
          example: 770e8400-e29b-41d4-a716-446655440002
      responses:
        '200':
          description: Song marked as unliked successfully
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                type: object
        '401':
          description: Unauthorized (invalid or missing JWT token)
          content:
            application/json:
              schema:
                type: object
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
      security:
        - bearerAuth: []
  /api/queue/songs/{id}/liked:
    get:
      tags:
        - Queue
      summary: Get song liked status
      description: Check if a song is liked by the authenticated user (QueueManager)
      operationId: getSongLikedStatus
      parameters:
        - name: id
          in: path
          description: Song UUID
          required: true
          schema:
            type: string
            format: uuid
          example: 770e8400-e29b-41d4-a716-446655440002
      responses:
        '200':
          description: Song liked status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SongLikedResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SongLikedResponse'
        '401':
          description: Unauthorized (invalid or missing JWT token)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SongLikedResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SongLikedResponse'
      security:
        - bearerAuth: []
    post:
      tags:
        - Queue
      summary: Mark song as liked
      description: Mark a song as liked by the authenticated user (QueueManager)
      operationId: markSongAsLiked
      parameters:
        - name: id
          in: path
          description: Song UUID
          required: true
          schema:
            type: string
            format: uuid
          example: 770e8400-e29b-41d4-a716-446655440002
      responses:
        '200':
          description: Song marked as liked successfully
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                type: object
        '401':
          description: Unauthorized (invalid or missing JWT token)
          content:
            application/json:
              schema:
                type: object
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
      security:
        - bearerAuth: []
  /api/queue/queue:
    get:
      tags:
        - Queue
      summary: Get songs in queue
      description: Retrieve all songs in the queue for the authenticated user (QueueManager)
      operationId: getQueue
      responses:
        '200':
          description: Queue retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueueResponse'
        '401':
          description: Unauthorized (invalid or missing JWT token)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueueResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueueResponse'
      security:
        - bearerAuth: []
    post:
      tags:
        - Queue
      summary: Add song to queue
      description: Add a song to the queue at a specific position (QueueManager)
      operationId: addSongToQueue
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddSongToQueueRequest'
        required: true
      responses:
        '200':
          description: Song added to queue successfully
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request (missing required fields or invalid position)
          content:
            application/json:
              schema:
                type: object
        '401':
          description: Unauthorized (invalid or missing JWT token)
          content:
            application/json:
              schema:
                type: object
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
      security:
        - bearerAuth: []
  /api/queue/queue/skipped:
    post:
      tags:
        - Queue
      summary: Mark song as skipped
      description: Mark a song as skipped and remove it from the queue, then refill queue (QueueManager)
      operationId: markSongAsSkipped
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SongIdRequest'
        required: true
      responses:
        '200':
          description: Song marked as skipped successfully
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request (missing songId)
          content:
            application/json:
              schema:
                type: object
        '401':
          description: Unauthorized (invalid or missing JWT token)
          content:
            application/json:
              schema:
                type: object
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
      security:
        - bearerAuth: []
  /api/queue/queue/finished:
    post:
      tags:
        - Queue
      summary: Mark song as finished
      description: Mark a song as finished, increment listen count, remove from queue, and refill queue (QueueManager)
      operationId: markSongAsFinished
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SongIdRequest'
        required: true
      responses:
        '200':
          description: Song marked as finished successfully
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request (missing songId)
          content:
            application/json:
              schema:
                type: object
        '401':
          description: Unauthorized (invalid or missing JWT token)
          content:
            application/json:
              schema:
                type: object
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
      security:
        - bearerAuth: []
  /api/queue/queue/check:
    post:
      tags:
        - Queue
      summary: Check and refill queue
      description: Manually trigger queue check and refill to ensure minimum queue size (QueueManager)
      operationId: checkAndRefillQueue
      responses:
        '200':
          description: Queue check completed successfully
          content:
            application/json:
              schema:
                type: object
        '401':
          description: Unauthorized (invalid or missing JWT token)
          content:
            application/json:
              schema:
                type: object
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
      security:
        - bearerAuth: []
  /api/queue/songs/{id}:
    get:
      tags:
        - Queue
      summary: Get song file
      description: Download the audio file for a song by ID. Returns the audio file with appropriate content type (QueueManager)
      operationId: getSong
      parameters:
        - name: id
          in: path
          description: Song UUID
          required: true
          schema:
            type: string
            format: uuid
          example: 770e8400-e29b-41d4-a716-446655440002
      responses:
        '200':
          description: Song file retrieved successfully
          content:
            audio/mpeg: {}
        '401':
          description: Unauthorized (invalid or missing JWT token)
          content:
            application/json:
              schema:
                type: string
                format: binary
        '404':
          description: Song not found
          content:
            application/json:
              schema:
                type: string
                format: binary
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: string
                format: binary
      security:
        - bearerAuth: []
  # PlaylistManager endpoints
  /api/playlist:
    get:
      tags:
        - Playlist
      summary: Get all playlists
      description: Retrieve all playlists owned by the authenticated user (PlaylistManager)
      operationId: getAllPlaylists
      responses:
        '200':
          description: Playlists retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaylistResponse'
        '401':
          description: Unauthorized (invalid or missing JWT token)
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PlaylistResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PlaylistResponse'
      security:
        - bearerAuth: []
    post:
      tags:
        - Playlist
      summary: Create new playlist
      description: Create a new playlist for the authenticated user (PlaylistManager)
      operationId: createPlaylist
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePlaylistRequest'
        required: true
      responses:
        '201':
          description: Playlist created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaylistResponse'
        '400':
          description: Bad request (validation error, missing required fields)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaylistResponse'
        '401':
          description: Unauthorized (invalid or missing JWT token)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaylistResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaylistResponse'
      security:
        - bearerAuth: []
  /api/playlist/{id}:
    get:
      tags:
        - Playlist
      summary: Get playlist with songs
      description: Get a specific playlist by ID with all its songs. Only accessible by the playlist owner (PlaylistManager)
      operationId: getPlaylist
      parameters:
        - name: id
          in: path
          description: Playlist UUID
          required: true
          schema:
            type: string
            format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Playlist retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaylistWithSongsResponse'
        '401':
          description: Unauthorized (invalid or missing JWT token)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaylistWithSongsResponse'
        '404':
          description: Playlist not found or access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaylistWithSongsResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaylistWithSongsResponse'
      security:
        - bearerAuth: []
    delete:
      tags:
        - Playlist
      summary: Delete playlist
      description: Delete a playlist by ID. Only accessible by the playlist owner (PlaylistManager)
      operationId: deletePlaylist
      parameters:
        - name: id
          in: path
          description: Playlist UUID
          required: true
          schema:
            type: string
            format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '204':
          description: Playlist deleted successfully (No Content)
        '401':
          description: Unauthorized (invalid or missing JWT token)
        '404':
          description: Playlist not found or access denied
        '500':
          description: Internal server error
      security:
        - bearerAuth: []
  /api/playlist/{id}/song/{songId}:
    post:
      tags:
        - Playlist
      summary: Add song to playlist
      description: Add a song (by UUID) to a playlist. Only accessible by the playlist owner (PlaylistManager)
      operationId: addSongToPlaylist
      parameters:
        - name: id
          in: path
          description: Playlist UUID
          required: true
          schema:
            type: string
            format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
        - name: songId
          in: path
          description: Song UUID (reference to QueueManager Song)
          required: true
          schema:
            type: string
            format: uuid
          example: 770e8400-e29b-41d4-a716-446655440002
      responses:
        '201':
          description: Song added to playlist successfully
        '400':
          description: Bad request (song already in playlist, validation error)
        '401':
          description: Unauthorized (invalid or missing JWT token)
        '404':
          description: Playlist not found or access denied
        '500':
          description: Internal server error
      security:
        - bearerAuth: []
    delete:
      tags:
        - Playlist
      summary: Remove song from playlist
      description: Remove a song from a playlist. Only accessible by the playlist owner (PlaylistManager)
      operationId: removeSongFromPlaylist
      parameters:
        - name: id
          in: path
          description: Playlist UUID
          required: true
          schema:
            type: string
            format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
        - name: songId
          in: path
          description: Song UUID
          required: true
          schema:
            type: string
            format: uuid
          example: 770e8400-e29b-41d4-a716-446655440002
      responses:
        '204':
          description: Song removed from playlist successfully (No Content)
        '401':
          description: Unauthorized (invalid or missing JWT token)
        '404':
          description: Playlist or song not found, or access denied
        '500':
          description: Internal server error
      security:
        - bearerAuth: []
  # Health check endpoints (all services)
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check if the service is running (available on all services)
      operationId: healthCheck
      responses:
        '200':
          description: Service is UP
          content:
            application/json:
              schema:
                type: string
  /:
    get:
      tags:
        - Health
      summary: Health check
      description: Check if the service is running (available on all services)
      operationId: health
      responses:
        '200':
          description: Service is UP
          content:
            application/json:
              schema:
                type: string
components:
  schemas:
    # AuthorizationManager schemas
    CreateUserRequest:
      type: object
      description: User creation data
      properties:
        username:
          type: string
          description: Username (alphanumeric, 3-20 characters)
          example: johndoe
        password:
          type: string
          format: password
          description: Password (minimum 6 characters)
          example: securepassword123
        email:
          type: string
          format: email
          description: Email address (optional)
          example: john.doe@example.com
      required:
        - password
        - username
    UserResponse:
      type: object
      description: User information response (without password)
      properties:
        id:
          type: string
          format: uuid
          description: User UUID
          example: 550e8400-e29b-41d4-a716-446655440000
        username:
          type: string
          description: Username
          example: johndoe
        email:
          type: string
          format: email
          description: User email
          example: john.doe@example.com
        createdAt:
          type: string
          format: date-time
          description: User creation timestamp
          example: '2024-01-01T12:00:00Z'
        updatedAt:
          type: string
          format: date-time
          description: User last update timestamp
          example: '2024-01-15T14:30:00Z'
      required:
        - createdAt
        - id
        - updatedAt
        - username
    LoginRequest:
      type: object
      description: Login credentials
      properties:
        username:
          type: string
          description: Username
          example: johndoe
        password:
          type: string
          format: password
          description: Password
          example: securepassword123
      required:
        - password
        - username
    LoginResponse:
      type: object
      description: Login response with JWT token and user information
      properties:
        token:
          type: string
          description: JWT authentication token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        userId:
          type: string
          format: uuid
          description: User UUID
          example: 550e8400-e29b-41d4-a716-446655440000
        username:
          type: string
          description: Username
          example: johndoe
        email:
          type: string
          format: email
          description: User email
          example: john.doe@example.com
      required:
        - email
        - token
        - userId
        - username
    # QueueManager schemas
    AddSongToQueueRequest:
      type: object
      description: Song ID and position to add to queue
      properties:
        songId:
          type: string
          format: uuid
          description: Song UUID
          example: 770e8400-e29b-41d4-a716-446655440002
        position:
          type: integer
          format: int32
          description: Position in queue (0-based)
          example: 0
      required:
        - position
        - songId
    SongIdRequest:
      type: object
      description: Song ID and optional queue entry ID
      properties:
        songId:
          type: string
          format: uuid
          description: Song UUID
          example: 770e8400-e29b-41d4-a716-446655440002
        queueEntryId:
          type: string
          format: uuid
          description: Optional queue entry ID - if provided, removes the specific queue entry instead of first match
          example: 880e8400-e29b-41d4-a716-446655440003
      required:
        - songId
    SongLikedResponse:
      type: object
      description: Response indicating if a song is liked by the user
      properties:
        liked:
          type: boolean
          description: Whether the song is liked
          example: true
      required:
        - liked
    QueueResponse:
      type: object
      description: Queue response containing list of songs
      properties:
        songs:
          type: array
          description: List of songs in the queue
          items:
            $ref: '#/components/schemas/SongDTO'
      required:
        - songs
    SongDTO:
      type: object
      description: Song information
      properties:
        id:
          type: string
          format: uuid
          description: Song UUID
          example: 770e8400-e29b-41d4-a716-446655440002
        title:
          type: string
          description: Song title
          example: Bohemian Rhapsody
        artist:
          type: string
          description: Artist name
          example: Queen
        album:
          type: string
          description: Album name
          example: A Night at the Opera
        genre:
          type: string
          description: Genre
          example: Rock
        duration:
          type: integer
          format: int64
          description: Duration in milliseconds
          example: 355000
        url:
          type: string
          description: File path/URL to the song file
        queueEntryId:
          type: string
          format: uuid
          description: Optional queue entry ID - only present when returned as part of a queue
          example: 880e8400-e29b-41d4-a716-446655440003
      required:
        - id
        - title
    # PlaylistManager schemas
    CreatePlaylistRequest:
      type: object
      description: Playlist creation data
      properties:
        name:
          type: string
          description: Playlist name (required)
          example: My Favorite Songs
        description:
          type: string
          description: Playlist description (optional)
          example: A collection of my favorite tracks
      required:
        - name
    PlaylistResponse:
      type: object
      description: Playlist information
      properties:
        id:
          type: string
          format: uuid
          description: Playlist UUID
          example: 550e8400-e29b-41d4-a716-446655440000
        userId:
          type: string
          format: uuid
          description: Owner user UUID
          example: 660e8400-e29b-41d4-a716-446655440001
        name:
          type: string
          description: Playlist name
          example: My Favorite Songs
        description:
          type: string
          description: Playlist description
          example: A collection of my favorite tracks
        createdAt:
          type: string
          format: date-time
          description: Playlist creation timestamp
          example: '2024-01-01T12:00:00Z'
        updatedAt:
          type: string
          format: date-time
          description: Playlist last update timestamp
          example: '2024-01-15T14:30:00Z'
      required:
        - createdAt
        - id
        - name
        - updatedAt
        - userId
    PlaylistSongResponse:
      type: object
      description: Song information within a playlist
      properties:
        songId:
          type: string
          format: uuid
          description: Song UUID (reference to QueueManager Song)
          example: 770e8400-e29b-41d4-a716-446655440002
        position:
          type: integer
          format: int32
          description: Position of song in playlist (0-based)
          example: 0
        addedAt:
          type: string
          format: date-time
          description: Timestamp when song was added to playlist
          example: '2024-01-10T10:00:00Z'
      required:
        - addedAt
        - position
        - songId
    PlaylistWithSongsResponse:
      type: object
      description: Playlist with all its songs
      properties:
        playlist:
          $ref: '#/components/schemas/PlaylistResponse'
          description: Playlist information
        songs:
          type: array
          description: List of songs in playlist, ordered by position
          items:
            $ref: '#/components/schemas/PlaylistSongResponse'
      required:
        - playlist
        - songs
  securitySchemes:
    bearerAuth:
      type: http
      description: 'JWT token in format: Bearer {token}'
      scheme: bearer
      bearerFormat: JWT
